<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  
  <title>Response - Gishiki</title>
  

  <link rel="shortcut icon" href="../../img/favicon.ico">

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="../../css/highlight.css">
  <link href="../../API/resources/style.css" rel="stylesheet">

  
  <script>
    // Current page data
    var mkdocs_page_name = "Response";
    var mkdocs_page_input_path = "usage/response.md";
    var mkdocs_page_url = "/usage/response/";
  </script>
  
  <script src="../../js/jquery-2.1.1.min.js"></script>
  <script src="../../js/modernizr-2.8.3.min.js"></script>
  <script type="text/javascript" src="../../js/highlight.pack.js"></script>
  <script src="../../js/theme.js"></script> 
  <script src="../../API/elementlist.js"></script>
  <script src="../../API/resources/combined.js"></script>

  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../.." class="icon icon-home"> Gishiki</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        <ul class="current">
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../..">Home</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Installation</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/">Environment</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/basic_php/">Basic PHP</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/php_7_nginx/">PHP 7.0 & nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/basic_nginx/">Basic nginx</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/basic_apache/">Basic apache</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/basic_lighttpd/">Basic lighttpd</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/basic_iis/">Basic IIS</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/composer/">Composer</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../installation/paas/">PaaS</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <li class="toctree-l1 ">
        <a class="" href="../../apidoc/">API</a>
        
    </li>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>Usage</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../configuration/">Configuration</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../routing/">Router</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../request/">Request</a>
        
    </li>

        
            
    <li class="toctree-l1 current">
        <a class="current" href="./">Response</a>
        
            <ul>
            
                <li class="toctree-l3"><a href="#response">Response</a></li>
                
                    <li><a class="toctree-l4" href="#response-header">Response Header</a></li>
                
                    <li><a class="toctree-l4" href="#response-header-details">Response Header Details</a></li>
                
                    <li><a class="toctree-l4" href="#response-body">Response Body</a></li>
                
            
            </ul>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../logging/">Logger</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../pipeline/">Pipeline</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../database/">Database</a>
        
    </li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../CRUD/">CRUD</a>
        
    </li>

        
    </ul>
<li>
          
            <li>
    <ul class="subnav">
    <li><span>About</span></li>

        
            
    <li class="toctree-l1 ">
        <a class="" href="../../license/">License</a>
        
    </li>

        
    </ul>
<li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../..">Gishiki</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../..">Docs</a> &raquo;</li>
    
      
        
          <li>Usage &raquo;</li>
        
      
    
    <li>Response</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="response">Response</h1>
<p>The <strong>Gishiki\HttpKernel\Response</strong> class is used to fully represent an HTTP response.</p>
<p>The Response class is PSR-7 conformant and follows that specification sheet.</p>
<p>Each <a href="../request/">Request</a> triggers the generation of a response.</p>
<p>That response is automatically sent back to the client at the end of the
application lifetime.</p>
<p>The main target of an application is <strong>editing</strong> that response before the departure
of that response.</p>
<p>An HTTP response is made of two parts:</p>
<ul>
<li>Response <strong>header</strong> </li>
<li>Response <strong>body</strong></li>
</ul>
<p>Those parts and steps to generate them are described later on this document.</p>
<h2 id="response-header">Response Header</h2>
<p>Every HTTP response <strong>MUST</strong> contains an header.</p>
<p>An HTTP header have a bare minimum structure that comprises the HTTP revision,
the status code and the message associated to the status code.</p>
<p>Since each status code have its own predefined status phrase (like 404 not found,
500 internal server error, 200 OK and so on) when the status code is changed the
status phrase is automatically changed by the framework.</p>
<p>That can be done calling the <strong>withStatus</strong> function:</p>
<pre><code class="php">use Gishiki\Core\Route;
use Gishiki\HttpKernel\Request;
use Gishiki\HttpKernel\Response;
use Gishiki\Algorithms\Collections\SerializableCollection;

Route::any(Route::NOT_FOUND,
    function (Request $request, Response &amp;$response, SerializableCollection &amp;$arguments)
{
    //the response code - phrase will be 404 - Not Found
    $response-&gt;withStatus(404);
});
</code></pre>

<p>You can manually change the status phrase, but you are discouraged from doing such
thing with standard status code!</p>
<p>What you can do is using it to send a strong signal to a bad client:</p>
<pre><code class="php">use Gishiki\Core\Route;
use Gishiki\HttpKernel\Request;
use Gishiki\HttpKernel\Response;
use Gishiki\Algorithms\Collections\SerializableCollection;

Route::any(&quot;/complex&quot;,
    function (Request $request, Response &amp;$response, SerializableCollection &amp;$arguments)
{
    //numberOfRequests is the number of requests that a client has sent today
    if ($numberOfRequests &gt; 5) {
        //perform the complex operation (may stress the system)
        action();
    } else {
        //stop flooding my servers!
        $response-&gt;withStatus(666, 'FUCK YOU!');
    }
});
</code></pre>

<p>Sorry for the bad language, that was only intended to help me to give you a (real :D)
example of usage.</p>
<h2 id="response-header-details">Response Header Details</h2>
<p>Each response can contains a lot of details about itselfs like the length of the
content or the type of the content.</p>
<p>Each 'response detail' is a collection of values binded to a key which is the name
of the property.</p>
<p>In order to edit the value of a property you have to use the <strong>withHeader</strong> function:</p>
<pre><code class="php">use Gishiki\Core\Route;
use Gishiki\HttpKernel\Request;
use Gishiki\HttpKernel\Response;
use Gishiki\Algorithms\Collections\SerializableCollection;

Route::any(&quot;/complex&quot;,
    function (Request $request, Response &amp;$response, SerializableCollection &amp;$arguments)
{
    $request-&gt;withHeader('Cache-Control', 'no-store, no-cache, must-revalidate');
});
</code></pre>

<p>If you are unsure on how to use this feature you should read more about http response <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers">header</a>.</p>
<h2 id="response-body">Response Body</h2>
<p>The body of the response is the main part of the response: the <strong>content</strong> of the
response.</p>
<p>For example if the response is an html content the response body is what the
user calls <em>the webpage</em>.</p>
<p>To directly modify the response body you can use the <strong>write</strong> function:</p>
<pre><code class="php">use Gishiki\Core\Route;
use Gishiki\HttpKernel\Request;
use Gishiki\HttpKernel\Response;
use Gishiki\Algorithms\Collections\SerializableCollection;

Route::any(&quot;/&quot;,
    function (Request $request, Response &amp;$response, SerializableCollection &amp;$arguments)
{
    $content = &lt;&lt;&lt;EOT
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;My webpage&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;My webpage&lt;/h1&gt;
        &lt;p&gt;Hello, this is my personal webpage!&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
EOT;

    //write the response
    $response-&gt;withHeader('Content-Type', 'text/html');
    $response-&gt;write($content);
});
</code></pre>

<p>This is a simple example to Gishiki used to generate an html response,
however since Gishiki is built to be used as the foundation of RESTful services
the response body shoild be a JSON, XML, YAML etc... content.</p>
<p>To generate a response body from a serializable data collection Gishiki provides
a function that automate this process: this function is called <strong>setSerializedBody</strong>
and does more than just converting a collection to a fixed format:</p>
<pre><code class="php">use Gishiki\Core\Route;
use Gishiki\HttpKernel\Request;
use Gishiki\HttpKernel\Response;
use Gishiki\Algorithms\Collections\SerializableCollection;

Route::any(&quot;/factorial/{int:integer}&quot;,
    function (Request $request, Response &amp;$response, SerializableCollection &amp;$arguments)
{
    $x = $arguments-&gt;int;
    $factorial = fact($x);

    $data = new SerializableCollection([
        'timestamp' =&gt; time(),
        'result'    =&gt; $factorial,
    ]);

    $response-&gt;setSerializedBody($data);
});
</code></pre>

<p>The given collection may be serialized to a JSON content, XML content or YAML content.
You may decide the content type by setting the header 'Content-Type' <strong>BUT THAT IS A WASTE OF TIME</strong>:
Gishiki <strong>AUTOMAGICALLY</strong> uses the content type listening for client preferences.</p>
<p>This means that a client is not enforced to be able to deserialize a specific
content type, but can choose the preferred content-type including it on the
http request header using the 'Accept' property!</p>
<p>Following accept values are used to request a specific data serialization format:</p>
<ul>
<li>'text/yaml'            -&gt; YAML</li>
<li>'text/x-yaml'          -&gt; YAML</li>
<li>'application/yaml'     -&gt; YAML</li>
<li>'application/x-yaml'   -&gt; XML</li>
<li>'application/xml'      -&gt; XML</li>
<li>'text/xml'             -&gt; XML</li>
<li>'application/json'     -&gt; JSON</li>
</ul>
<p>Anything else triggers the default serialization format, which is JSON!</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../logging/" class="btn btn-neutral float-right" title="Logger">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../request/" class="btn btn-neutral" title="Request"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
	  
        </div>
      </div>

    </section>

  </div>

<div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../request/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../logging/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>

</body>
</html>
